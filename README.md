# Vulnerability Assessment Project

This project demonstrates a basic vulnerability assessment setup using OpenVAS and Metasploitable on Docker.

## Overview

<img width="1352" alt="Screenshot 2024-06-24 at 4 51 55 PM" src="https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/15a7eb95-9ff3-4414-bb0e-c4e38ab3198f">


### Diagram Description

- **Docker Host**: The machine where Docker and Docker Compose are installed. This is the environment where both OpenVAS and Metasploitable containers are running. It's the central platform for managing these containers using Docker and Docker Compose.
- **Docker Containers**:
    - **OpenVAS Container**: Runs the OpenVAS vulnerability scanner. This container runs the OpenVAS vulnerability scanner. It's responsible for scanning the target (Metasploitable) and generating reports on detected vulnerabilities.
    - **Metasploitable Container**: The vulnerable target system. This container runs the Metasploitable 2, a deliberately vulnerable Linux distribution used for testing security tools and practices.
- **User**: Interacts with the system, mainly to start the script and view results. The person initiating the automation script and monitoring the results through the OpenVAS web interface.
- **OpenVAS Web Interface**: A web-based interface to monitor and analyze scan results. A web-based interface provided by OpenVAS where users can monitor ongoing scans, view reports, and manage scan configurations.

## Prerequisites

- Ubuntu 22.04 LTS
- Docker
- Docker Compose

## Setup Instructions

### 1. Install Docker and Docker Compose:
    
```bash
sudo apt update
sudo apt install -y docker.io docker-compose
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker $USER
```
    
Restart the system for the changes to take effect.

### 2. Pull Docker Images:

#### Pull OpenVAS Docker image

- OpenVAS is a popular open-source vulnerability scanner.

    ```bash
    docker pull mikesplain/openvas
    ```

![Screenshot 2024-06-24 032223](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/4a8b0616-7889-48fe-b372-8b1b08088c2c)

#### Pull Metasploitable Docker image

- Metasploitable is a vulnerable target for testing purposes.

    ```bash
    docker pull tleemcjr/metasploitable2
    ```

![Screenshot 2024-06-24 032228](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/caf48828-3811-45f7-838d-9bae13447206)


### 3. Clone the Repository:

```bash
git clone https://github.com/MenakaGodakanda/vulnerability-assessment.git
cd vulnerability-assessment
```

### 4. Start the Containers:
    
```bash
docker-compose up -d
```

When you run `docker-compose up -d`, you should see something like:

![Screenshot 2024-06-24 032711](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/e863024e-e020-44c0-b91f-645941f16bb0)

## Usage

### Ensure the Docker containers are running.

Verify the containers are running:

```
docker ps -a
```

Output should be something like this:
```
CONTAINER ID    IMAGE                       COMMAND                    CREATED              STATUS            PORTS                                                                                                                                                                                    NAMES
89926c6ecf0e    mikesplain/openvas          "/bin/sh -c /start"        27 minutes ago       Up 27 minutes     9390/tcp, 0.0.0.0:9443->443/tcp, :::9443->443/tcp, 0.0.0.0:9492->9392/tcp, :::9492->9392/tcp                                                                                             vulnerability-assessment_openvas_1
9ff06a583558    tleemcjr/metasploitable2    "/bin/bash -c 'while…"     27 minutes ago       Up 27 minutes     0.0.0.0:80->80/tcp, :::80->80/tcp, 0.0.0.0:443->443/tcp, 0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 0.0.0.0:5900->5900/tcp, :::5900->5900/tcp, 0.0.0.0:2222->22/tcp, :::2222->22/tcp     vulnerability-assessment_metasploitable_1
```
![Screenshot 2024-06-24 035438](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/e197c85d-82d8-44d2-be55-e2eebf15a4e5)


### Monitor the OpenVAS web interface for scan results.

#### Accessing the OpenVAS Web Interface

##### 1. Access the OpenVAS Web Interface

Open your web browser and navigate to the OpenVAS web interface using the new port mappings:

```
https://<your-docker-host-ip>:9492
```

Replace `<your-docker-host-ip>` with the IP address of your Docker host. If you are running this on a local machine, you can use `localhost`.



##### 2. Login to OpenVAS

You will need to login with the default credentials:

- Username: `admin`
- Password: `admin`

(You might be prompted to change the password after the first login for security reasons.)

![Screenshot 2024-06-24 175906](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/efdd855c-c94a-4383-a7ec-233f86b8d832)
<br><br>
![Screenshot 2024-06-24 033413](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/fe86f65d-7245-4639-b7ae-5cafac987f8c)


##### 3. Create a New Target in OpenVAS

To scan the Metasploitable container, you need to create a target in OpenVAS:

- Go to the Configuration tab.
- Select Targets.
- Click the New Target button.
- Fill in the details:
    - Name: `Metasploitable`
    - Hosts: `metasploitable`
- Click Save.

![Screenshot 2024-06-24 034659](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/ab69cb2b-b007-4647-8649-adc956b2035e)

##### 4. Create a New Task in OpenVAS

After creating the target, create a new task to perform the scan:

- Go to the Scans tab.
- Select Tasks.
- Click the New Task button.
- Fill in the details:
    - Name: `Scan Metasploitable`
    - Comment: `Automated scan of Metasploitable`
    - Scan Config: `Full and fast` (or any other scan config you prefer)
    - Target: `Metasploitable`
- Click Save.

![Screenshot 2024-06-24 034932](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/da5ef703-68a9-4a86-90e9-e971074e8c41)


##### 5. Start the Scan

Start the scan you just created:

- In the Tasks tab, find the `Scan Metasploitable` task.
- Click the Start button.

#### Viewing the Scan Results

Monitor the progress of the scan from the Scans tab. Once the scan is complete, you can view detailed reports of the vulnerabilities found.

![Screenshot 2024-06-24 130818](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/dea8f1c8-4fef-4824-a5b7-b420919f9b25)
<br><br>
![Screenshot 2024-06-24 130846](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/a8a826ad-5197-4c9f-8326-d502d1449a4d)


## File Structure

```
vulnerability-assessment/
├── docker-compose.yml
├── README.md
```

## Troubleshooting

### Finding the IP Address

#### Finding Docker Host IP

1. Open Terminal: Start by opening a terminal on your Ubuntu VirtualBox.

2. Check Docker Network Details:

Run the following command to inspect the Docker network details:

```bash
ip a
```

Look for the IP address associated with your primary network interface (e.g., `eth0`, `enp0s3`, or `wlan0`). This IP address is typically the IP address of your VirtualBox Ubuntu host.

3. Determine IP Address:

Identify the IP address listed under `inet` for your primary network interface. It will look something like `192.168.x.x` or `10.x.x.x`. This is your Docker host IP address.

#### Finding the IP Address of the Container

To find the IP address of the Metasploitable container, you can use the following command:

```bash
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <container_name_or_id>
```

Replace `<container_name_or_id>` with the name or ID of your Metasploitable container. For example, if your container name is `vulnerability-assessment_metasploitable_1`, you would run:

```bash
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' vulnerability-assessment_metasploitable_1
```

Example Output:
![Screenshot 2024-06-24 033000](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/c16f3272-a817-4139-b338-61460e535ea7)
<br>
![Screenshot 2024-06-24 033049](https://github.com/MenakaGodakanda/vulnerability-assessment/assets/156875412/e6631533-88f9-47f0-86f6-18c956600c48)


### Required Port is Used By Another Process

#### Step 1: Identify the Process Using Port 443

For example, lets assume port 443 is already in use by another process or container on your host machine. To resolve this issue, you can either stop the service that is using port 443 or change the port mapping in your `docker-compose.yml` file.

First, identify which process is using port 443:

```bash
sudo lsof -i -P -n | grep LISTEN
```

This command will list all processes listening on network ports. Look for the process using port 443.

#### Step 2: Stop the Conflicting Process (Optional)

If it's safe to stop the process that is using port 443, you can do so. For example, if Apache or Nginx is using port 443, you can stop it:

```bash
sudo systemctl stop apache2
# or
sudo systemctl stop nginx
```

#### Step 3: Change the Port Mapping in `docker-compose.yml`
If you cannot stop the process or prefer not to, you can change the port mapping for the container to use a different port. For example, you can map port 9443 on the host to port 443 in the container.

Update your `docker-compose.yml` file.

#### Step 4: Restart Docker Compose

Now, bring up the Docker Compose project again:

```bash
docker-compose up -d
```

This should start the containers without port conflicts.

#### Step 5: Verify Containers Are Running

Check the status of the containers to ensure they are running:

```bash
docker ps -a
```

### Metasploitable container is not running properly

#### 1. Check Container Logs

First, check the logs of the Metasploitable container to see why it exited:

```bash
docker logs vulnerability-assessment_metasploitable_1
```

This command will display the logs and may provide insights into why the container stopped.

#### 2. Restart the Metasploitable Container

Try restarting the Metasploitable container to see if it was a transient issue:

```bash
docker start vulnerability-assessment_metasploitable_1
```

Then, check its status:

```bash
docker ps -a
```

#### 3. Review Docker Compose Configuration
Ensure that the Docker Compose configuration for the Metasploitable container is correct and complete. Check the `docker-compose.yml` file.

#### 4. Inspect Docker Container Configuration
Inspect the container configuration to ensure it's set up correctly:

```bash
docker inspect vulnerability-assessment_metasploitable_1
```

Look for any configuration issues or misconfigurations.

#### 5. Run the Container in Interactive Mode

To diagnose issues interactively, try running the container in interactive mode:

```bash
docker run -it tleemcjr/metasploitable2 /bin/bash
```

This command will start the Metasploitable container and drop you into a bash shell inside the container. You can then manually start services and see if any errors occur.

Once inside the container, try to find the service management command:

```bash
which service
which systemctl
ls /etc/init.d/
```

Here is an example of an interactive session where you identify available services:

```bash
docker run -it tleemcjr/metasploitable2 /bin/bash

# Inside the container
which service
# If it returns a path, you can use `service --status-all`
# If not, list init scripts
ls /etc/init.d/
```

#### 6. Check Docker Resources

Ensure your Docker environment has enough resources (CPU, memory, disk space) to run both containers:

```bash
docker system info
```

Look for resource allocation and usage statistics.


#### 7. Restart Docker Compose
After making the changes, restart Docker Compose:

```bash
docker-compose down
docker-compose up -d
```

## License

This project is licensed under the MIT License.
